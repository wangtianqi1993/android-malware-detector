# !/usr/bin/env python
# -*- coding: utf-8 -*-
__author__ = 'wtq'

import os
import zipfile


def get_dexfile():
    """
    extract the classes.dex file from apk
    :return:
    """

    apk_path = '/home/wtq/apk/'
    dex_path = '/home/wtq/apkdex/'
    apklist = os.listdir(apk_path)
    print ('waiting...')
    if not os.path.exists(dex_path):
        os.makedirs(dex_path)

    for APK in apklist:
        portion = os.path.splitext(APK)
        if portion[1] == '.apk':
            newname = portion[0] + '.zip'
            # 使用rename得在当前目录下所以加上os.path,join(),也可使用partion[1]='.zip'
            os.rename(os.path.join(apk_path, APK), newname)

        if APK.endswith('.zip'):
            apkname = portion[0]
            zip_apk_path = os.path.join(apk_path, APK)
            z = zipfile.ZipFile(zip_apk_path, 'r')

            for filename in z.namelist():
                if filename.endswith('.dex'):
                    dexfilename = apkname + '.dex'
                    dexfilepath = os.path.join(dex_path, dexfilename)
                    f = open(dexfilepath, 'w+')
                    f.write(z.read(filename))


if __name__ == '__main__':
    get_dexfile()




